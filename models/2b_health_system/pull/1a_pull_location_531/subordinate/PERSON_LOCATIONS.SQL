-----------------------------------------------
-- PERSON_LOCATIONS
-----------------------------------------------
SELECT
    DISTINCT MIN(PATIENT.ADD_LINE_1) AS ADDRESS_1
    , MIN(PATIENT.ADD_LINE_2) AS ADDRESS_2
    , MIN(PATIENT.CITY) AS CITY
    , MIN(LEFT(ZC_STATE.ABBR, 2)) AS STATE
    , MIN(LEFT(PATIENT.ZIP, 5)) AS ZIP
    , MIN(ZC_COUNTY.NAME) AS COUNTY
	,LEFT(COALESCE (PATIENT.ADD_LINE_1, '') 
		|| COALESCE(PATIENT.ADD_LINE_2, '') 
		|| COALESCE(PATIENT.CITY, '') 
		|| COALESCE(LEFT(ZC_STATE.ABBR, 2), '') 
		|| COALESCE(PATIENT.ZIP, '') 
		|| COALESCE(ZC_COUNTY.COUNTY_C, ''), 50) 
	AS LOCATION_SOURCE_VALUE
	
FROM SH_OMOP_DB_PROD.CDM.AOU_DRIVER AS AOU
	INNER JOIN {{ source('CLARITY','PATIENT')}}	as PATIENT-- SH_CLINICAL_DB_PROD.E
		ON PATIENT.PAT_ID = AOU.EPIC_PAT_ID
	LEFT OUTER JOIN {{ source('CLARITY','ZC_STATE')}} as ZC_STATE--  SH_CLINICAL_D
		ON PATIENT.STATE_C = ZC_STATE.STATE_C
	LEFT OUTER JOIN {{ source('CLARITY','ZC_COUNTY')}}	as ZC_COUNTY-- SH_CLINICAL
		ON PATIENT.COUNTY_C = ZC_COUNTY.COUNTY_C
		
GROUP BY LEFT(COALESCE(PATIENT.ADD_LINE_1, '') 
		|| COALESCE(PATIENT.ADD_LINE_2, '') 
		|| COALESCE(PATIENT.CITY, '') 
		|| COALESCE(LEFT(ZC_STATE.ABBR, 2), '') 
		|| COALESCE(PATIENT.ZIP, '') 
		|| COALESCE(ZC_COUNTY.COUNTY_C, ''), 50)