  {{ config(materialized='ephemeral') }}

--Encounter physician PointOfService

  
	SELECT DISTINCT CLARITY_POS.*, ZC_STATE.ABBR as STATE_ABBR, ZC_COUNTY.NAME AS COUNTY
	FROM  {{ref('AOU_DRIVER')}} AS AOU_DRIVER 
    	INNER JOIN {{ source('CLARITY','PAT_ENC')}}	 as PAT_ENC 
    		ON PAT_ENC.PAT_ID = AOU_DRIVER.EPIC_PAT_ID
    	LEFT JOIN {{ source('CLARITY','CLARITY_DEP')}}	 as CLARITY_DEP 
    		ON PAT_ENC.DEPARTMENT_ID = CLARITY_DEP.DEPARTMENT_ID
    	LEFT JOIN {{ source('CLARITY','CLARITY_POS')}}	 as CLARITY_POS 
    		ON CLARITY_DEP.REV_LOC_ID = CLARITY_POS.POS_ID
		LEFT JOIN {{ source('CLARITY','ZC_STATE')}}	 as ZC_STATE
			ON CLARITY_POS.STATE_C = ZC_STATE.STATE_C
		LEFT JOIN {{ source('CLARITY','ZC_COUNTY')}}	 as ZC_COUNTY
			ON CLARITY_POS.COUNTY_C = ZC_COUNTY.COUNTY_C